<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>能耗统计 - 隧道废水处理智能平台</title>
    <link rel="stylesheet" href="../css/common.css">
    <link rel="stylesheet" href="../css/layout.css">
    <link rel="stylesheet" href="../css/modules.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="page-wrapper">
        <aside class="sidebar">
            <div class="sidebar-logo"><i class="fas fa-water"></i><span class="logo-text">废水处理平台</span></div>
            <nav class="sidebar-menu">
                <div class="menu-section"><div class="menu-label">综合看板</div>
                    <div class="menu-item"><a href="dashboard-company.html" class="menu-link"><span class="menu-icon"><i class="fas fa-chart-line"></i></span><span class="menu-text">公司级看板</span></a></div>
                    <div class="menu-item"><a href="dashboard-project.html" class="menu-link"><span class="menu-icon"><i class="fas fa-chart-bar"></i></span><span class="menu-text">项目级看板</span></a></div>
                </div>
                <div class="menu-section"><div class="menu-label">设备管理</div>
                    <div class="menu-item"><a href="device-list.html" class="menu-link"><span class="menu-icon"><i class="fas fa-list"></i></span><span class="menu-text">设备档案</span></a></div>
                </div>
                <div class="menu-section"><div class="menu-label">在线监控</div>
                    <div class="menu-item has-submenu">
                        <a href="javascript:void(0)" class="menu-link"><span class="menu-icon"><i class="fas fa-desktop"></i></span><span class="menu-text">实时监控</span><span class="menu-arrow"><i class="fas fa-chevron-down"></i></span></a>
                        <div class="submenu">
                            <div class="menu-item"><a href="monitor-realtime.html" class="menu-link"><span class="menu-text">实时数据</span></a></div>
                            <div class="menu-item"><a href="monitor-history.html" class="menu-link"><span class="menu-text">历史数据</span></a></div>
                            <div class="menu-item"><a href="monitor-alarm.html" class="menu-link"><span class="menu-text">报警管理</span></a></div>
                            <div class="menu-item"><a href="monitor-video.html" class="menu-link"><span class="menu-text">视频监控</span></a></div>
                            <div class="menu-item"><a href="monitor-digitaltwin.html" class="menu-link"><span class="menu-text">数字孪生</span></a></div>
                        </div>
                    </div>
                </div>
                <div class="menu-section"><div class="menu-label">统计分析</div>
                    <div class="menu-item"><a href="report-list.html" class="menu-link"><span class="menu-icon"><i class="fas fa-file-alt"></i></span><span class="menu-text">数据报表</span></a></div>
                    <div class="menu-item"><a href="report-energy.html" class="menu-link active"><span class="menu-icon"><i class="fas fa-bolt"></i></span><span class="menu-text">能耗统计</span></a></div>
                </div>
                <div class="menu-section"><div class="menu-label">系统管理</div>
                    <div class="menu-item"><a href="user-manage.html" class="menu-link"><span class="menu-icon"><i class="fas fa-users"></i></span><span class="menu-text">人员管理</span></a></div>
                    <div class="menu-item"><a href="javascript:void(0)" class="menu-link"><span class="menu-icon"><i class="fas fa-cog"></i></span><span class="menu-text">系统设置</span></a></div>
                </div>
            </nav>
        </aside>
        <div class="sidebar-overlay"></div>
        <main class="main-content">
            <header class="header">
                <div class="header-left">
                    <button class="toggle-btn"><i class="fas fa-bars"></i></button>
                    <nav class="breadcrumb">
                        <span class="breadcrumb-item"><a href="../index.html">首页</a></span>
                        <span class="breadcrumb-item">统计分析</span>
                        <span class="breadcrumb-item">能耗统计</span>
                    </nav>
                </div>
                <div class="header-right">
                    <button class="header-action notification-btn"><i class="fas fa-bell"></i><span class="badge-count">3</span></button>
                    <button class="header-action fullscreen-btn"><i class="fas fa-expand"></i></button>
                    <div class="user-info"><div class="user-avatar">A</div><div class="user-details"><div class="user-name">管理员</div><div class="user-role">系统管理员</div></div></div>
                    <a href="../index.html" class="header-action logout-btn"><i class="fas fa-sign-out-alt"></i></a>
                </div>
            </header>
            <div class="content-wrapper">
                <div class="content-container">
                    <div class="page-header"><h1 class="page-title">能耗统计</h1><p class="page-description">分析各项目设备能耗情况，优化能源使用</p></div>
                    <div class="action-bar">
                        <div class="action-bar-left">
                            <select class="form-select filter-select" id="energyProject">
                                <option value="">所有项目</option>
                            </select>
                            <select class="form-select filter-select" id="energyPeriod">
                                <option value="today">今日</option>
                                <option value="week" selected>本周</option>
                                <option value="month">本月</option>
                                <option value="year">本年</option>
                            </select>
                            <button class="btn btn-primary" onclick="queryEnergy()"><i class="fas fa-search"></i> 查询</button>
                        </div>
                        <div class="action-bar-right">
                            <button class="btn btn-default" onclick="exportEnergyData()"><i class="fas fa-download"></i> 导出</button>
                        </div>
                    </div>
                    <div class="energy-overview">
                        <div class="energy-card">
                            <div class="text-secondary">今日能耗</div>
                            <div class="energy-card-value" id="todayEnergy">0<span class="energy-card-unit">kWh</span></div>
                            <div class="text-sm text-secondary">较昨日 <span class="text-success">-5.2%</span></div>
                        </div>
                        <div class="energy-card">
                            <div class="text-secondary">本周能耗</div>
                            <div class="energy-card-value" id="weekEnergy">0<span class="energy-card-unit">kWh</span></div>
                            <div class="text-sm text-secondary">较上周 <span class="text-success">-2.8%</span></div>
                        </div>
                        <div class="energy-card">
                            <div class="text-secondary">本月能耗</div>
                            <div class="energy-card-value" id="monthEnergy">0<span class="energy-card-unit">kWh</span></div>
                            <div class="text-sm text-secondary">较上月 <span class="text-warning">+3.1%</span></div>
                        </div>
                        <div class="energy-card">
                            <div class="text-secondary">本年能耗</div>
                            <div class="energy-card-value" id="yearEnergy">0<span class="energy-card-unit">kWh</span></div>
                            <div class="text-sm text-secondary">年度目标完成 <span class="text-primary">68%</span></div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-8">
                            <div class="card">
                                <div class="card-header"><span class="card-title">能耗趋势</span></div>
                                <div class="card-body"><div id="energyTrendChart" style="height: 350px;"></div></div>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="card">
                                <div class="card-header"><span class="card-title">能耗占比</span></div>
                                <div class="card-body"><div id="energyPieChart" style="height: 350px;"></div></div>
                            </div>
                        </div>
                    </div>
                    <div class="row mt-16">
                        <div class="col-6">
                            <div class="energy-ranking">
                                <div class="card-header"><span class="card-title">项目能耗排名</span></div>
                                <div class="card-body" style="padding: 0;" id="projectRanking"></div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="card">
                                <div class="card-header"><span class="card-title">设备类型能耗对比</span></div>
                                <div class="card-body"><div id="deviceTypeEnergyChart" style="height: 300px;"></div></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <script src="../js/common.js"></script>
    <script src="../js/data.js"></script>
    <script>
        let energyTrendChart, energyPieChart, deviceTypeEnergyChart;
        document.addEventListener('DOMContentLoaded',function(){initProjectSelect();loadEnergyData();initCharts();});
        function initProjectSelect(){const select=document.getElementById('energyProject');mockData.projects.forEach(project=>{const option=document.createElement('option');option.value=project.id;option.textContent=project.name;select.appendChild(option);});}
        function loadEnergyData(){const today=18250,week=125680,month=523450,year=3250000;document.getElementById('todayEnergy').innerHTML=today.toLocaleString()+'<span class="energy-card-unit">kWh</span>';document.getElementById('weekEnergy').innerHTML=week.toLocaleString()+'<span class="energy-card-unit">kWh</span>';document.getElementById('monthEnergy').innerHTML=month.toLocaleString()+'<span class="energy-card-unit">kWh</span>';document.getElementById('yearEnergy').innerHTML=(year/1000).toLocaleString()+'k<span class="energy-card-unit">kWh</span>';}
        function initCharts(){energyTrendChart=echarts.init(document.getElementById('energyTrendChart'));energyPieChart=echarts.init(document.getElementById('energyPieChart'));deviceTypeEnergyChart=echarts.init(document.getElementById('deviceTypeEnergyChart'));initEnergyTrendChart();initEnergyPieChart();initDeviceTypeEnergyChart();initProjectRanking();window.addEventListener('resize',function(){energyTrendChart.resize();energyPieChart.resize();deviceTypeEnergyChart.resize();});}
        function initEnergyTrendChart(){const data=mockData.energyHistory.slice(-30);energyTrendChart.setOption({tooltip:{trigger:'axis'},legend:{data:['总能耗','设备1','设备2']},xAxis:{type:'category',data:data.map(d=>d.date.slice(5))},yAxis:{type:'value',name:'kWh'},series:[{name:'总能耗',type:'line',data:data.map(d=>d.totalEnergy),smooth:true,itemStyle:{color:'#1890ff'},areaStyle:{color:{type:'linear',x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:'rgba(24,144,255,0.3)'},{offset:1,color:'rgba(24,144,255,0.05)'}]}}},{name:'设备1',type:'line',data:data.map(d=>d.dev001),smooth:true,itemStyle:{color:'#52c41a'}},{name:'设备2',type:'line',data:data.map(d=>d.dev002),smooth:true,itemStyle:{color:'#faad14'}}]});}
        function initEnergyPieChart(){energyPieChart.setOption({tooltip:{trigger:'item',formatter:'{b}: {c} kWh ({d}%)'},series:[{type:'pie',radius:['40%','70%'],avoidLabelOverlap:false,itemStyle:{borderRadius:10,borderColor:'#fff',borderWidth:2},label:{show:true,formatter:'{b}\n{c}'},emphasis:{label:{show:true,fontSize:14,fontWeight:'bold'}},data:mockData.projects.map((p,i)=>({name:p.name.slice(0,4),value:Math.floor(Math.random()*50000+10000),itemStyle:{color:['#1890ff','#52c41a','#faad14','#722ed1','#13c2c2','#eb2f96','#fa8c16','#2f54eb'][i%8]}}))}]});}
        function initDeviceTypeEnergyChart(){const data=mockData.deviceTypeStats;deviceTypeEnergyChart.setOption({tooltip:{trigger:'axis'},xAxis:{type:'category',data:Object.keys(data)},yAxis:{type:'value',name:'kWh'},series:[{type:'bar',data:Object.entries(data).map(([k,v])=>[k,Math.floor(v*2000+1000)]),itemStyle:{color:'#1890ff'}}]});}
        function initProjectRanking(){const container=document.getElementById('projectRanking');const ranking=mockData.projects.map((p,i)=>({name:p.name,energy:Math.floor(Math.random()*50000+10000)})).sort((a,b)=>b.energy-a.energy);container.innerHTML=ranking.map((item,index)=>{const rankClass=index===0?'top-1':index===1?'top-2':index===2?'top-3':'other';return`<div class="energy-ranking-item"><span class="energy-ranking-rank ${rankClass}">${index+1}</span><span class="energy-ranking-name">${item.name}</span><span class="energy-ranking-value">${item.energy.toLocaleString()} kWh</span></div>`;}).join('');}
        function queryEnergy(){app.showToast('正在查询能耗数据...','info');setTimeout(()=>{app.showToast('查询完成','success');},500);}
        function exportEnergyData(){const data=mockData.energyHistory.map(d=({date:d.date,total:d.totalEnergy,dev001:d.dev001,dev002:d.dev002}));app.exportToCsv(data,'能耗数据.csv');app.showToast('能耗数据导出成功','success');}
    </script>
</body>
</html>