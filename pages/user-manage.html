<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>人员管理 - 隧道废水处理智能平台</title>
    <link rel="stylesheet" href="../css/common.css">
    <link rel="stylesheet" href="../css/layout.css">
    <link rel="stylesheet" href="../css/modules.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="page-wrapper">
        <aside class="sidebar">
            <div class="sidebar-logo">
                <i class="fas fa-water"></i>
                <span class="logo-text">废水处理平台</span>
            </div>

            <nav class="sidebar-menu">
                <div class="menu-section">
                    <div class="menu-label">综合看板</div>
                    <div class="menu-item">
                        <a href="dashboard-company.html" class="menu-link">
                            <span class="menu-icon"><i class="fas fa-chart-line"></i></span>
                            <span class="menu-text">公司级看板</span>
                        </a>
                    </div>
                    <div class="menu-item">
                        <a href="dashboard-project.html" class="menu-link">
                            <span class="menu-icon"><i class="fas fa-chart-bar"></i></span>
                            <span class="menu-text">项目级看板</span>
                        </a>
                    </div>
                </div>

                <div class="menu-section">
                    <div class="menu-label">设备管理</div>
                    <div class="menu-item">
                        <a href="device-list.html" class="menu-link">
                            <span class="menu-icon"><i class="fas fa-list"></i></span>
                            <span class="menu-text">设备档案</span>
                        </a>
                    </div>
                </div>

                <div class="menu-section">
                    <div class="menu-label">在线监控</div>
                    <div class="menu-item has-submenu">
                        <a href="javascript:void(0)" class="menu-link">
                            <span class="menu-icon"><i class="fas fa-desktop"></i></span>
                            <span class="menu-text">实时监控</span>
                            <span class="menu-arrow"><i class="fas fa-chevron-down"></i></span>
                        </a>
                        <div class="submenu">
                            <div class="menu-item">
                                <a href="monitor-realtime.html" class="menu-link">
                                    <span class="menu-text">实时数据</span>
                                </a>
                            </div>
                            <div class="menu-item">
                                <a href="monitor-history.html" class="menu-link">
                                    <span class="menu-text">历史数据</span>
                                </a>
                            </div>
                            <div class="menu-item">
                                <a href="monitor-alarm.html" class="menu-link">
                                    <span class="menu-text">报警管理</span>
                                </a>
                            </div>
                            <div class="menu-item">
                                <a href="monitor-video.html" class="menu-link">
                                    <span class="menu-text">视频监控</span>
                                </a>
                            </div>
                            <div class="menu-item">
                                <a href="monitor-digitaltwin.html" class="menu-link">
                                    <span class="menu-text">数字孪生</span>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="menu-section">
                    <div class="menu-label">统计分析</div>
                    <div class="menu-item">
                        <a href="report-list.html" class="menu-link">
                            <span class="menu-icon"><i class="fas fa-file-alt"></i></span>
                            <span class="menu-text">数据报表</span>
                        </a>
                    </div>
                    <div class="menu-item">
                        <a href="report-energy.html" class="menu-link">
                            <span class="menu-icon"><i class="fas fa-bolt"></i></span>
                            <span class="menu-text">能耗统计</span>
                        </a>
                    </div>
                </div>

                <div class="menu-section">
                    <div class="menu-label">系统管理</div>
                    <div class="menu-item">
                        <a href="user-manage.html" class="menu-link active">
                            <span class="menu-icon"><i class="fas fa-users"></i></span>
                            <span class="menu-text">人员管理</span>
                        </a>
                    </div>
                    <div class="menu-item">
                        <a href="javascript:void(0)" class="menu-link">
                            <span class="menu-icon"><i class="fas fa-cog"></i></span>
                            <span class="menu-text">系统设置</span>
                        </a>
                    </div>
                </div>
            </nav>
        </aside>

        <div class="sidebar-overlay"></div>

        <main class="main-content">
            <header class="header">
                <div class="header-left">
                    <button class="toggle-btn">
                        <i class="fas fa-bars"></i>
                    </button>
                    <nav class="breadcrumb">
                        <span class="breadcrumb-item">
                            <a href="../index.html">首页</a>
                        </span>
                        <span class="breadcrumb-item">系统管理</span>
                        <span class="breadcrumb-item">人员管理</span>
                    </nav>
                </div>
                <div class="header-right">
                    <button class="header-action notification-btn">
                        <i class="fas fa-bell"></i>
                        <span class="badge-count">3</span>
                    </button>
                    <button class="header-action fullscreen-btn">
                        <i class="fas fa-expand"></i>
                    </button>
                    <div class="user-info">
                        <div class="user-avatar">A</div>
                        <div class="user-details">
                            <div class="user-name">管理员</div>
                            <div class="user-role">系统管理员</div>
                        </div>
                    </div>
                    <a href="../index.html" class="header-action logout-btn">
                        <i class="fas fa-sign-out-alt"></i>
                    </a>
                </div>
            </header>

            <div class="content-wrapper">
                <div class="content-container">
                    <div class="page-header">
                        <h1 class="page-title">人员管理</h1>
                        <p class="page-description">管理系统用户和权限</p>
                    </div>

                    <!-- 操作栏 -->
                    <div class="action-bar">
                        <div class="action-bar-left">
                            <div class="search-box">
                                <input type="text" class="search-input" placeholder="搜索用户名、姓名..." id="searchInput">
                                <i class="fas fa-search search-icon"></i>
                            </div>
                            <select class="form-select filter-select" id="roleFilter">
                                <option value="">所有角色</option>
                                <option value="admin">管理员</option>
                                <option value="engineer">工程师</option>
                                <option value="operator">操作员</option>
                                <option value="guest">访客</option>
                            </select>
                            <select class="form-select filter-select" id="statusFilter">
                                <option value="">所有状态</option>
                                <option value="active">正常</option>
                                <option value="inactive">禁用</option>
                            </select>
                        </div>
                        <div class="action-bar-right">
                            <button class="btn btn-default" onclick="exportUsers()">
                                <i class="fas fa-download"></i> 导出
                            </button>
                            <button class="btn btn-primary" onclick="showAddUserModal()">
                                <i class="fas fa-plus"></i> 添加用户
                            </button>
                        </div>
                    </div>

                    <!-- 用户列表 -->
                    <div class="card">
                        <div class="card-body" style="padding: 0;">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>
                                            <input type="checkbox" id="selectAll">
                                        </th>
                                        <th>用户名</th>
                                        <th>姓名</th>
                                        <th>角色</th>
                                        <th>部门</th>
                                        <th>手机</th>
                                        <th>邮箱</th>
                                        <th>状态</th>
                                        <th>最后登录</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody id="userTableBody">
                                    <!-- 用户数据将通过JS动态生成 -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- 分页 -->
                    <div class="card">
                        <div class="card-body" style="display: flex; justify-content: space-between; align-items: center;">
                            <div style="color: var(--text-secondary);">
                                共 <span id="totalCount">0</span> 条记录
                            </div>
                            <div style="display: flex; gap: 8px;">
                                <button class="btn btn-sm btn-default" onclick="changePage('prev')" id="prevBtn">
                                    <i class="fas fa-chevron-left"></i> 上一页
                                </button>
                                <span style="padding: 8px 16px; background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 4px;">
                                    第 <span id="currentPage">1</span> / <span id="totalPages">1</span> 页
                                </span>
                                <button class="btn btn-sm btn-default" onclick="changePage('next')" id="nextBtn">
                                    下一页 <i class="fas fa-chevron-right"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- 用户详情模态框 -->
    <div id="userDetailModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3 class="modal-title">用户详情</h3>
                <button class="modal-close" onclick="app.hideModal('userDetailModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body" id="userDetailContent">
                <!-- 用户详情内容将通过JS动态生成 -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-default" onclick="app.hideModal('userDetailModal')">关闭</button>
                <button class="btn btn-primary" onclick="editUser()">编辑</button>
            </div>
        </div>
    </div>

    <script src="../js/common.js"></script>
    <script src="../js/data.js"></script>
    <script>
        let currentPage = 1;
        const pageSize = 10;
        let filteredUsers = [...mockData.users];

        document.addEventListener('DOMContentLoaded', function() {
            loadUserList();

            // 搜索功能
            document.getElementById('searchInput').addEventListener('input', debounce(function() {
                filterUsers();
            }, 300));

            // 筛选功能
            document.getElementById('roleFilter').addEventListener('change', filterUsers);
            document.getElementById('statusFilter').addEventListener('change', filterUsers);
        });

        function filterUsers() {
            const searchValue = document.getElementById('searchInput').value.toLowerCase();
            const roleValue = document.getElementById('roleFilter').value;
            const statusValue = document.getElementById('statusFilter').value;

            filteredUsers = mockData.users.filter(user => {
                const matchSearch = !searchValue ||
                    user.name.toLowerCase().includes(searchValue) ||
                    user.username.toLowerCase().includes(searchValue);

                const matchRole = !roleValue || user.role === roleValue;
                const matchStatus = !statusValue || user.status === statusValue;

                return matchSearch && matchRole && matchStatus;
            });

            currentPage = 1;
            loadUserList();
        }

        function loadUserList() {
            const tbody = document.getElementById('userTableBody');
            const start = (currentPage - 1) * pageSize;
            const end = start + pageSize;
            const pageUsers = filteredUsers.slice(start, end);

            const roleText = {
                'admin': '管理员',
                'engineer': '工程师',
                'operator': '操作员',
                'guest': '访客'
            };

            const roleTag = {
                'admin': 'tag-danger',
                'engineer': 'tag-primary',
                'operator': 'tag-info',
                'guest': 'tag-warning'
            };

            tbody.innerHTML = pageUsers.map(user => `
                <tr>
                    <td><input type="checkbox" class="user-checkbox" value="${user.id}"></td>
                    <td>${user.username}</td>
                    <td>
                        <span class="user-table-name">
                            <span class="user-table-avatar">${user.avatar}</span>
                            ${user.name}
                        </span>
                    </td>
                    <td><span class="tag ${roleTag[user.role]}">${roleText[user.role]}</span></td>
                    <td>${user.department}</td>
                    <td>${user.phone}</td>
                    <td>${user.email}</td>
                    <td>
                        <span class="tag ${user.status === 'active' ? 'tag-success' : 'tag-secondary'}">
                            ${user.status === 'active' ? '正常' : '禁用'}
                        </span>
                    </td>
                    <td>${user.lastLoginTime}</td>
                    <td>
                        <button class="btn btn-sm btn-default" onclick="viewUserDetail(${user.id})">
                            <i class="fas fa-eye"></i> 查看
                        </button>
                        <button class="btn btn-sm btn-primary" onclick="editUserById(${user.id})">
                            <i class="fas fa-edit"></i> 编辑
                        </button>
                    </td>
                </tr>
            `).join('');

            // 更新分页信息
            const totalPages = Math.ceil(filteredUsers.length / pageSize);
            document.getElementById('totalCount').textContent = filteredUsers.length;
            document.getElementById('currentPage').textContent = currentPage;
            document.getElementById('totalPages').textContent = totalPages;
            document.getElementById('prevBtn').disabled = currentPage === 1;
            document.getElementById('nextBtn').disabled = currentPage === totalPages;
        }

        function changePage(direction) {
            const totalPages = Math.ceil(filteredUsers.length / pageSize);

            if (direction === 'prev' && currentPage > 1) {
                currentPage--;
            } else if (direction === 'next' && currentPage < totalPages) {
                currentPage++;
            }

            loadUserList();
        }

        function viewUserDetail(userId) {
            const user = mockData.users.find(u => u.id === userId);
            if (!user) return;

            const roleText = {
                'admin': '管理员',
                'engineer': '工程师',
                'operator': '操作员',
                'guest': '访客'
            };

            const content = document.getElementById('userDetailContent');
            content.innerHTML = `
                <div style="text-align: center; margin-bottom: 24px;">
                    <div class="user-avatar" style="width: 80px; height: 80px; font-size: 32px; margin: 0 auto 16px;">${user.avatar}</div>
                    <h3 style="margin: 0;">${user.name}</h3>
                    <p style="color: var(--text-secondary); margin-top: 8px;">@${user.username}</p>
                </div>

                <table class="table">
                    <tr>
                        <td style="width: 120px; font-weight: bold;">用户名</td>
                        <td>${user.username}</td>
                    </tr>
                    <tr>
                        <td style="font-weight: bold;">姓名</td>
                        <td>${user.name}</td>
                    </tr>
                    <tr>
                        <td style="font-weight: bold;">角色</td>
                        <td>${roleText[user.role]}</td>
                    </tr>
                    <tr>
                        <td style="font-weight: bold;">部门</td>
                        <td>${user.department}</td>
                    </tr>
                    <tr>
                        <td style="font-weight: bold;">手机</td>
                        <td>${user.phone}</td>
                    </tr>
                    <tr>
                        <td style="font-weight: bold;">邮箱</td>
                        <td>${user.email}</td>
                    </tr>
                    <tr>
                        <td style="font-weight: bold;">状态</td>
                        <td><span class="tag ${user.status === 'active' ? 'tag-success' : 'tag-secondary'}">${user.status === 'active' ? '正常' : '禁用'}</span></td>
                    </tr>
                    <tr>
                        <td style="font-weight: bold;">创建时间</td>
                        <td>${user.createTime}</td>
                    </tr>
                    <tr>
                        <td style="font-weight: bold;">最后登录</td>
                        <td>${user.lastLoginTime}</td>
                    </tr>
                </table>
            `;

            app.showModal('userDetailModal');
        }

        function editUser() {
            app.showToast('编辑用户功能开发中', 'info');
        }

        function editUserById(userId) {
            app.showToast('编辑用户: ' + userId, 'info');
        }

        function showAddUserModal() {
            app.showToast('添加用户功能开发中', 'info');
        }

        function exportUsers() {
            const roleText = {
                'admin': '管理员',
                'engineer': '工程师',
                'operator': '操作员',
                'guest': '访客'
            };

            const exportData = filteredUsers.map(user => ({
                '用户名': user.username,
                '姓名': user.name,
                '角色': roleText[user.role],
                '部门': user.department,
                '手机': user.phone,
                '邮箱': user.email,
                '状态': user.status === 'active' ? '正常' : '禁用',
                '创建时间': user.createTime
            }));

            app.exportToCsv(exportData, '用户列表.csv');
        }
    </script>
</body>
</html>
