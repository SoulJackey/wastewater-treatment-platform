<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>设备详情 - 隧道废水处理智能平台</title>
    <link rel="stylesheet" href="../css/common.css">
    <link rel="stylesheet" href="../css/layout.css">
    <link rel="stylesheet" href="../css/modules.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .device-detail-header { display: flex; gap: 24px; margin-bottom: 24px; }
        .device-detail-image { width: 300px; height: 200px; background: linear-gradient(135deg, #f5f5f5 0%, #e8e8e8 100%); border-radius: 4px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .device-detail-image i { font-size: 80px; color: var(--primary-color); }
        .device-detail-info { flex: 1; }
        .device-detail-title { font-size: 24px; font-weight: bold; margin-bottom: 16px; }
        .device-detail-meta { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 16px; }
        .device-detail-section { margin-bottom: 24px; }
        .device-detail-section-title { font-size: 16px; font-weight: bold; margin-bottom: 16px; padding-bottom: 8px; border-bottom: 2px solid var(--primary-color); }
        .qr-code { width: 120px; height: 120px; background: #fff; padding: 8px; border: 1px solid var(--border-color); border-radius: 4px; display: flex; align-items: center; justify-content: center; margin: 16px auto; }
        .maintenance-record { display: flex; align-items: center; padding: 12px; background: #fafafa; border-radius: 4px; margin-bottom: 8px; }
        .maintenance-icon { width: 40px; height: 40px; background: var(--primary-color); color: #fff; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 16px; flex-shrink: 0; }
        .maintenance-info { flex: 1; }
        .maintenance-title { font-weight: 500; margin-bottom: 4px; }
        .maintenance-date { font-size: 12px; color: var(--text-secondary); }
    </style>
</head>
<body>
    <div class="page-wrapper">
        <aside class="sidebar">
            <div class="sidebar-logo"><i class="fas fa-water"></i><span class="logo-text">废水处理平台</span></div>
            <nav class="sidebar-menu">
                <div class="menu-section"><div class="menu-label">综合看板</div>
                    <div class="menu-item"><a href="dashboard-company.html" class="menu-link"><span class="menu-icon"><i class="fas fa-chart-line"></i></span><span class="menu-text">公司级看板</span></a></div>
                    <div class="menu-item"><a href="dashboard-project.html" class="menu-link"><span class="menu-icon"><i class="fas fa-chart-bar"></i></span><span class="menu-text">项目级看板</span></a></div>
                </div>
                <div class="menu-section"><div class="menu-label">设备管理</div>
                    <div class="menu-item"><a href="device-list.html" class="menu-link active"><span class="menu-icon"><i class="fas fa-list"></i></span><span class="menu-text">设备档案</span></a></div>
                </div>
                <div class="menu-section"><div class="menu-label">在线监控</div>
                    <div class="menu-item has-submenu">
                        <a href="javascript:void(0)" class="menu-link"><span class="menu-icon"><i class="fas fa-desktop"></i></span><span class="menu-text">实时监控</span><span class="menu-arrow"><i class="fas fa-chevron-down"></i></span></a>
                        <div class="submenu">
                            <div class="menu-item"><a href="monitor-realtime.html" class="menu-link"><span class="menu-text">实时数据</span></a></div>
                            <div class="menu-item"><a href="monitor-history.html" class="menu-link"><span class="menu-text">历史数据</span></a></div>
                            <div class="menu-item"><a href="monitor-alarm.html" class="menu-link"><span class="menu-text">报警管理</span></a></div>
                            <div class="menu-item"><a href="monitor-video.html" class="menu-link"><span class="menu-text">视频监控</span></a></div>
                            <div class="menu-item"><a href="monitor-digitaltwin.html" class="menu-link"><span class="menu-text">数字孪生</span></a></div>
                        </div>
                    </div>
                </div>
                <div class="menu-section"><div class="menu-label">统计分析</div>
                    <div class="menu-item"><a href="report-list.html" class="menu-link"><span class="menu-icon"><i class="fas fa-file-alt"></i></span><span class="menu-text">数据报表</span></a></div>
                    <div class="menu-item"><a href="report-energy.html" class="menu-link"><span class="menu-icon"><i class="fas fa-bolt"></i></span><span class="menu-text">能耗统计</span></a></div>
                </div>
                <div class="menu-section"><div class="menu-label">系统管理</div>
                    <div class="menu-item"><a href="user-manage.html" class="menu-link"><span class="menu-icon"><i class="fas fa-users"></i></span><span class="menu-text">人员管理</span></a></div>
                    <div class="menu-item"><a href="javascript:void(0)" class="menu-link"><span class="menu-icon"><i class="fas fa-cog"></i></span><span class="menu-text">系统设置</span></a></div>
                </div>
            </nav>
        </aside>
        <div class="sidebar-overlay"></div>
        <main class="main-content">
            <header class="header">
                <div class="header-left">
                    <button class="toggle-btn" onclick="window.history.back()"><i class="fas fa-arrow-left"></i></button>
                    <nav class="breadcrumb">
                        <span class="breadcrumb-item"><a href="../index.html">首页</a></span>
                        <span class="breadcrumb-item"><a href="device-list.html">设备管理</a></span>
                        <span class="breadcrumb-item">设备详情</span>
                    </nav>
                </div>
                <div class="header-right">
                    <button class="header-action notification-btn"><i class="fas fa-bell"></i><span class="badge-count">3</span></button>
                    <button class="header-action fullscreen-btn"><i class="fas fa-expand"></i></button>
                    <div class="user-info"><div class="user-avatar">A</div><div class="user-details"><div class="user-name">管理员</div><div class="user-role">系统管理员</div></div></div>
                    <a href="../index.html" class="header-action logout-btn"><i class="fas fa-sign-out-alt"></i></a>
                </div>
            </header>
            <div class="content-wrapper">
                <div class="content-container">
                    <div class="page-header" style="display: flex; justify-content: space-between; align-items: center;">
                        <div><h1 class="page-title" id="deviceTitle">设备详情</h1><p class="page-description" id="deviceSubtitle">查看设备详细信息</p></div>
                        <div>
                            <button class="btn btn-default" onclick="editDevice()"><i class="fas fa-edit"></i> 编辑</button>
                            <button class="btn btn-primary" onclick="monitorDevice()"><i class="fas fa-desktop"></i> 实时监控</button>
                        </div>
                    </div>
                    <div id="deviceDetailContent"></div>
                </div>
            </div>
        </main>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <script src="../js/common.js"></script>
    <script src="../js/data.js"></script>
    <script>
        let currentDevice=null;
        document.addEventListener('DOMContentLoaded',function(){const deviceId=app.getUrlParam('id')||'DEV001';loadDeviceDetail(deviceId);});
        function loadDeviceDetail(deviceId){currentDevice=mockData.devices.find(d=>d.id===deviceId);if(!currentDevice){app.showToast('设备不存在','error');return;}const realtimeData=mockData.deviceRealtimeData[deviceId]||{};const statusText={running:'运行中',stopped:'已停止',warning:'警告',error:'故障'};document.getElementById('deviceTitle').textContent=currentDevice.name;document.getElementById('deviceSubtitle').textContent=currentDevice.id;const content=document.getElementById('deviceDetailContent');content.innerHTML=`
            <div class="device-detail-header">
                <div class="device-detail-image"><i class="fas fa-cogs"></i></div>
                <div class="device-detail-info">
                    <div class="device-detail-title">${currentDevice.name}</div>
                    <div class="device-detail-meta">
                        <div class="device-param"><div class="device-param-label">设备编号</div><div class="device-param-value">${currentDevice.id}</div></div>
                        <div class="device-param"><div class="device-param-label">设备类型</div><div class="device-param-value">${currentDevice.type}</div></div>
                        <div class="device-param"><div class="device-param-label">型号</div><div class="device-param-value">${currentDevice.model}</div></div>
                        <div class="device-param"><div class="device-param-label">状态</div><div class="device-param-value"><span class="tag ${currentDevice.status==='running'?'tag-success':currentDevice.status==='warning'?'tag-warning':'tag-danger'}">${statusText[currentDevice.status]}</span></div></div>
                        <div class="device-param"><div class="device-param-label">制造商</div><div class="device-param-value">${currentDevice.manufacturer}</div></div>
                        <div class="device-param"><div class="device-param-label">所属项目</div><div class="device-param-value">${currentDevice.projectName}</div></div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-8">
                    <div class="device-detail-section">
                        <div class="device-detail-section-title">基本信息</div>
                        <table class="table">
                            <tr><td style="width: 120px; font-weight: bold;">设备名称</td><td>${currentDevice.name}</td><td style="width: 120px; font-weight: bold;">设备编号</td><td>${currentDevice.id}</td></tr>
                            <tr><td style="font-weight: bold;">设备类型</td><td>${currentDevice.type}</td><td style="font-weight: bold;">型号</td><td>${currentDevice.model}</td></tr>
                            <tr><td style="font-weight: bold;">制造商</td><td>${currentDevice.manufacturer}</td><td style="font-weight: bold;">出厂日期</td><td>${currentDevice.productionDate}</td></tr>
                            <tr><td style="font-weight: bold;">安装日期</td><td>${currentDevice.installDate}</td><td style="font-weight: bold;">保修到期</td><td>${currentDevice.warrantyDate}</td></tr>
                            <tr><td style="font-weight: bold;">所属项目</td><td>${currentDevice.projectName}</td><td style="font-weight: bold;">状态</td><td><span class="tag ${currentDevice.status==='running'?'tag-success':currentDevice.status==='warning'?'tag-warning':'tag-danger'}">${statusText[currentDevice.status]}</span></td></tr>
                        </table>
                    </div>
                    <div class="device-detail-section">
                        <div class="device-detail-section-title">技术规格</div>
                        <table class="table">
                            <tr><td style="width: 120px; font-weight: bold;">处理能力</td><td>${currentDevice.specifications.capacity}</td><td style="width: 120px; font-weight: bold;">功率</td><td>${currentDevice.specifications.power}</td></tr>
                            <tr><td style="font-weight: bold;">外形尺寸</td><td>${currentDevice.specifications.dimension}</td><td style="font-weight: bold;">重量</td><td>${currentDevice.specifications.weight}</td></tr>
                        </table>
                    </div>
                    <div class="device-detail-section">
                        <div class="device-detail-section-title">资产信息</div>
                        <table class="table">
                            <tr><td style="width: 120px; font-weight: bold;">原值</td><td>¥${currentDevice.originalValue.toLocaleString()}</td><td style="width: 120px; font-weight: bold;">折旧率</td><td>${(currentDevice.depreciationRate*100).toFixed(0)}%</td></tr>
                            <tr><td style="font-weight: bold;">当前净值</td><td>¥${currentDevice.currentValue.toLocaleString()}</td><td style="font-weight: bold;">折旧金额</td><td>¥${(currentDevice.originalValue-currentDevice.currentValue).toLocaleString()}</td></tr>
                        </table>
                    </div>
                </div>
                <div class="col-4">
                    <div class="card">
                        <div class="card-header"><span class="card-title">实时数据</span></div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-6"><div class="device-param"><div class="device-param-label">PH值</div><div class="device-param-value">${realtimeData.ph||'-'}</div></div></div>
                                <div class="col-6"><div class="device-param"><div class="device-param-label">液位</div><div class="device-param-value">${realtimeData.liquidLevel||'-'}%</div></div></div>
                                <div class="col-6"><div class="device-param"><div class="device-param-label">流量</div><div class="device-param-value">${realtimeData.flow||'-'}m³/h</div></div></div>
                                <div class="col-6"><div class="device-param"><div class="device-param-label">温度</div><div class="device-param-value">${realtimeData.temperature||'-'}°C</div></div></div>
                                <div class="col-6"><div class="device-param"><div class="device-param-label">功率</div><div class="device-param-value">${realtimeData.power||'-'}kW</div></div></div>
                                <div class="col-6"><div class="device-param"><div class="device-param-label">运行时长</div><div class="device-param-value">${Math.floor(Math.random()*5000+3000)}h</div></div></div>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header"><span class="card-title">设备二维码</span></div>
                        <div class="card-body">
                            <div class="qr-code">
                                <i class="fas fa-qrcode" style="font-size: 80px; color: var(--text-primary);"></i>
                            </div>
                            <p style="text-align: center; color: var(--text-secondary); font-size: 12px;">${currentDevice.qrCode}</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row mt-16">
                <div class="col-6">
                    <div class="card">
                        <div class="card-header"><span class="card-title">保养记录</span><button class="btn btn-sm btn-default">查看全部</button></div>
                        <div class="card-body" style="max-height: 300px; overflow-y: auto;">${loadMaintenanceRecords()}</div>
                    </div>
                </div>
                <div class="col-6">
                    <div class="card">
                        <div class="card-header"><span class="card-title">维修记录</span><button class="btn btn-sm btn-default">查看全部</button></div>
                        <div class="card-body" style="max-height: 300px; overflow-y: auto;">${loadRepairRecords()}</div>
                    </div>
                </div>
            </div>
            <div class="card mt-16">
                <div class="card-header"><span class="card-title">运行趋势（近7天）</span></div>
                <div class="card-body"><div id="deviceTrendChart" style="height: 300px;"></div></div>
            </div>`;initDeviceTrendChart();}
        function loadMaintenanceRecords(){const records=mockData.maintenanceRecords.filter(r=>r.deviceId===currentDevice?.id).slice(0,3);if(records.length===0)return'<div class="empty-state"><i class="fas fa-tools empty-icon"></i><p class="empty-text">暂无保养记录</p></div>';return records.map(r=>`<div class="maintenance-record"><div class="maintenance-icon"><i class="fas fa-wrench"></i></div><div class="maintenance-info"><div class="maintenance-title">${r.type} - ${r.content}</div><div class="maintenance-date">${r.maintenanceDate} · ${r.maintainer}</div></div></div>`).join('');}
        function loadRepairRecords(){const records=mockData.repairRecords.filter(r=>r.deviceId===currentDevice?.id).slice(0,3);if(records.length===0)return'<div class="empty-state"><i class="fas fa-tools empty-icon"></i><p class="empty-text">暂无维修记录</p></div>';return records.map(r=>`<div class="maintenance-record"><div class="maintenance-icon" style="background: var(--warning-color);"><i class="fas fa-exclamation-triangle"></i></div><div class="maintenance-info"><div class="maintenance-title">${r.faultDescription}</div><div class="maintenance-date">${r.faultTime} · ${r.repairPerson}</div></div></div>`).join('');}
        function initDeviceTrendChart(){const chart=echarts.init(document.getElementById('deviceTrendChart'));const data=mockData.energyHistory.slice(-7);chart.setOption({tooltip:{trigger:'axis'},legend:{data:['功率','流量']},xAxis:{type:'category',data:data.map(d=>d.date.slice(5))},yAxis:[{type:'value',name:'功率(kW)'},{type:'value',name:'流量(m³/h)'}],series:[{name:'功率',type:'line',data:data.map(()=>(Math.random()*20+10).toFixed(1)),smooth:true,itemStyle:{color:'#1890ff'}},{name:'流量',type:'line',yAxisIndex:1,data:data.map(()=>(Math.random()*15+10).toFixed(1)),smooth:true,itemStyle:{color:'#52c41a'}}]});window.addEventListener('resize',()=>chart.resize());}
        function editDevice(){app.showToast('编辑设备功能开发中','info');}
        function monitorDevice(){if(currentDevice)window.location.href=`monitor-realtime.html?deviceId=${currentDevice.id}`;}
    </script>
</body>
</html>